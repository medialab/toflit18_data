use "/Users/guillaumedaudin/Documents/Recherche/Commerce International Français XVIIIe.xls/Balance du commerce/Retranscriptions_Commerce_France/Données Stata/bdd courante.dta", clear


format value %-15.2fc
replace value=value/1000000

keep if exportsimports=="Imports"
drop if sourcetype=="Divers" | sourcetype=="Tableau Général"

replace country_grouping ="Pas Outre-mers" if country_grouping !="Outre-mers"

collapse (sum) value, by(year direction product_canada sourcetype country_grouping)
*fillin year direction product_canada country_grouping
replace value=. if value==0

gen commerce_national = 1 if (sourcetype=="Objet Général" & year<=1786) | (sourcetype=="Résumé" & year <= 1790) | sourcetype=="National toutes directions tous partenaires"

save blink.dta, replace
keep if year==1750 & sourcetype=="National toutes directions tous partenaires"
collapse (sum) value, by(year product_canada sourcetype country_grouping commerce_national)
append using blink.dta
erase blink.dta
replace commerce_national=0 if direction!=""

gen commerce_local = 1 if sourcetype=="Local" & year!=1750 | sourcetype=="National toutes directions tous partenaires" | ////
			(sourcetype=="National toutes directions partenaires manquants" & year==1788 & country_grouping=="Outre-mers") | ////
			(sourcetype=="National toutes directions partenaires manquants" & year==1789 & country_grouping=="Pas Outre-mers")

**Nous n'avons pas les importations depuis les colonies par direction de ferme !


local conditions_options commerce_national==1 & country_grouping=="Outre-mers", msize(small) cmissing(n) 

twoway (connected value year if product_canada=="Exclusivement Canada" & `conditions_options') ///
		(connected value year if product_canada=="Peut-être Canada"  & `conditions_options') ///
		(connected value year if product_canada=="Hors Canada" & `conditions_options') ///
		, legend(label(1 "Exclusivement Canada") label(2 "Peut-être Canada") label(3 "Hors Canada")) ///
		ytitle("Millions de livres tournois") title("National, Outre-Mers") ///
		xscale(range(1715 1790)) xlabel(1720 (10) 1790) ///
		name("Objet_General_OM", replace)		
		
		
local conditions_options commerce_national==1 & country_grouping=="Pas Outre-mers", msize(small) cmissing(n) 
		
twoway (connected value year if product_canada=="Exclusivement Canada" & `conditions_options') ///
		(connected value year if product_canada=="Peut-être Canada"  & `conditions_options') ///
		(connected value year if product_canada=="Hors Canada"  & `conditions_options') ///
		, legend(label(1 "Exclusivement Canada") label(2 "Peut-être Canada") label(3 "Hors Canada")) ///
		ytitle("Millions de livres tournois") title("National, pas Outre-Mers") ///
		xscale(range(1715 1790)) xlabel(1720 (10) 1790) ///
		name("Objet_General_POM", replace)


 
foreach direction in Nantes Marseille Bayonne Bordeaux Rouen Rennes "La Rochelle"  {

	local name = subinstr("`direction'"," ","_",.)

	local conditions_options commerce_local==1 & direction=="`direction'" & country_grouping=="Outre-mers", msize(small) cmissing(n) 
	
	twoway (connected value year if product_canada=="Exclusivement Canada"  & `conditions_options') ///
		(connected value year if product_canada=="Peut-être Canada"  & `conditions_options') ///
		(connected value year if product_canada=="Hors Canada"  & `conditions_options') ///
		, legend(label(1 "Exclusivement Canada") label(2 "Peut-être Canada") label(3 "Hors Canada")) ///
		ytitle("Millions de livres tournois") title("`direction', Outre-Mers") ///
		xscale(range(1715 1790)) xlabel(1720 (10) 1790) ///
		name("`name'_OM", replace)
	
	local conditions_options commerce_local==1 & direction=="`direction'" & country_grouping=="Pas Outre-mers", msize(small) cmissing(n) 
		
	twoway  (connected value year if product_canada=="Exclusivement Canada"  & `conditions_options') ///
			(connected value year if  product_canada=="Peut-être Canada" & `conditions_options') ///
			(connected value year if product_canada=="Hors Canada"  & `conditions_options') ///
		, legend(label(1 "Exclusivement Canada") label(2 "Peut-être Canada") label(3 "Hors Canada")) ///
		ytitle("Millions de livres tournois") title("`direction', Pas Outre-Mers") ///
		xscale(range(1715 1790)) xlabel(1720 (10) 1790) ///
		name("`name'_POM", replace)	
}



collapse (sum) value, by(year direction  product_canada sourcetype commerce_national commerce_local)

local conditions_options commerce_national==1 , msize(small) cmissing(n) 

twoway (connected value year if  product_canada=="Exclusivement Canada" & `conditions_options') ///
		(connected value year if product_canada=="Peut-être Canada" & `conditions_options') ///
		(connected value year if product_canada=="Hors Canada" & `conditions_options') ///
		, legend(label(1 "Exclusivement Canada") label(2 "Peut-être Canada") label(3 "Hors Canada")) ///
		ytitle("Millions de livres tournois") title("National") ///
		xscale(range(1715 1790)) xlabel(1720 (10) 1790) ///
		name("Objet_General", replace)
		

foreach direction in Nantes Marseille Bayonne Bordeaux Rouen Rennes "La Rochelle"  {

	local name = subinstr("`direction'"," ","_",.)
	
	local conditions_options commerce_local==1 & direction=="`direction'", msize(small) cmissing(n) 
 

	twoway (connected value year if product_canada=="Exclusivement Canada" & `conditions_options') ///
		(connected value year if product_canada=="Peut-être Canada" & `conditions_options' ) ///
		(connected value year if product_canada=="Hors Canada" & `conditions_options') ///
		, legend(label(1 "Exclusivement Canada") label(2 "Peut-être Canada") label(3 "Hors Canada")) ///
		xscale(range(1715 1790)) xlabel(1720 (10) 1790) ///
		ytitle("Millions de livres tournois") title("`direction'") ///
		name("`name'", replace)

}
